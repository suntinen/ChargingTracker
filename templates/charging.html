{% extends "layout.html" %}
{% block title %}
Charging Events
<!-- This template is used as main page of user functionality to save charging events -->
{% endblock %}
{% block content %}
    <h3>Add New Charging Event</h3>
    <form method="post" action="{{ url_for('add_charging') }}">
        <label for="charging_station">Charging Station:</label>
        <select id="charging_station" name="charging_station">
            <option value="">Select station</option>
            {% for station in charging_stations %}
                <option value="{{ station.id }}">{{ station.station_name }}</option>
            {% endfor %}
        </select>

        <label for="vehicle">Car:</label>
        <select id="vehicle" name="vehicle">
            <option value="">Select car</option>
            {% for vehicle in vehicles %}
                <option value="{{ vehicle.id }}">{{ vehicle.vehicle_name }}</option>
            {% endfor %}
        </select>

        <label for="start_time">Start Time:</label>
        <input type="datetime-local" id="start_time" name="start_time" required>

        <label for="end_time">End Time:</label>
        <input type="datetime-local" id="end_time" name="end_time" required>

        <label for="charged_energy">Energy Charged (kWh):</label>
        <input type="number" id="charged_energy" name="charged_energy" required>

        <label for="cost">Cost (â‚¬):</label>
        <input type="number" id="cost" name="cost" required>

        <label for="mileage">Mileage:</label>
        <input type="number" id="mileage" name="mileage" required>

        <label for="destination">Destination:</label>
        <select id="destination" name="destination">
            <option value="">Select Destination</option>
            {% for destination in destinations %}
                <option value="{{ destination.id }}">{{ destination.destination_name }}</option>
            {% endfor %}
        </select>

        <input type="submit" class="btn btn-primary" value="Add Charging Event">
    </form>

    <div class="d-flex align-items-center justify-content-between mb-3">
        <h3 class="mb-0">Charging Events</h3>
        <select id="destinationFilter" onchange="filterByDestination()" class="form-control w-auto" style="background-color: white;">
            <option value="">Filter Destination</option>
            {% for destination in destinations %}
                <option value="{{ destination.id }}" {% if destination.id|string == selected_destination_id %}selected{% endif %}>
                    {{ destination.destination_name }}
                </option>
            {% endfor %}
        </select>
        
    </div>
    

<table class="table table-striped table-hover">
    <thead>
        <tr>
            <th>Charging Station</th>
            <th>Start Time</th>
            <th>End Time</th>
            <th>Energy Charged</th>
            <th>Cost</th>
            <th>Vehicle</th>
            <th>Mileage</th>
            <th>Destination</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for charging in chargings %}
    <tr>
        <td>{{ charging.station_name }}</td>
        <td>{{ charging.start_time }}</td>
        <td>{{ charging.end_time }}</td>
        <td>{{ charging.charged_energy }}</td>
        <td>{{ charging.cost }}</td>
        <td>{{ charging.vehicle_name }}</td>
        <td>{{ charging.mileage }}</td>
        <td>{{ charging.destination_name or 'N/A' }}</td>

        <td>
            <a href="{{ url_for('edit_charging', id=charging.id) }}" class="btn btn-sm btn-primary mr-2">Edit</a>
            <a href="/delete_charging/{{ charging.id }}" class="btn btn-sm btn-danger" onclick="return confirmDelete();">Delete</a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
<script>
    // Destination filter is used to filter charging events by destination in the table 
    function filterByDestination() {
        var destinationId = document.getElementById('destinationFilter').value;
        window.location.href = '/chargings?destinationFilter=' + destinationId;
    }
    // Confrim delete function is used to confirm the user's action to delete the charging event
    function confirmDelete() {
        return confirm('Are you sure you want to delete this charging event?');
    }
</script>      
{% endblock %}
